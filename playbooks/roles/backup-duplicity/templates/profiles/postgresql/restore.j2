#!/bin/bash

# This file was generated by Ansible for {{ ansible_fqdn }}
# Do NOT modify this file by hand!

WORKDIR={{ backup_work }}/{{ item[0]['name'] }}

HOST="{{ item[0]['pg_host'] | default('', true) }}"
USER="{{ item[0]['pg_user'] | default('', true) }}"
PASS="{{ item[0]['pg_password'] | default('', true) }}"

PSQL="psql"
if [ ! -z ${HOST} ]; then HOST="--host=${HOST}" ; else PSQL="sudo -u postgres psql"; fi
if [ ! -z ${USER} ]; then USER="--username=${USER}" ; fi
if [ ! -z ${PASS} ]; then PGPASSWORD="${PASS}" ; export PGPASSWORD; fi

${PSQL} psql ${USER} ${HOST} < $WORKDIR/dump

{% for action in item[0]['restore_actions']|default([]) %}
{{ action }}
{% endfor %}

if [ -d "${WORKDIR}" ] ; then
    rm -rf "${WORKDIR}"
fi

