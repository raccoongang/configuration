# This file was generated by Ansible for {{ ansible_fqdn }}
# Do NOT modify this file by hand!

# Setting only a passphrase and omitting the GPG key
# will enable symmetric passphrase-only encryption.
{% if backup_gpg_key == 'disabled' %}
GPG_KEY='disabled'
{% else %}
GPG_KEY='{{ backup_gpg_key }}'
GPG_PW='{{ backup_gpg_pw }}'
GPG_KEYS_ENC='{{ backup_gpg_keys_enc }}'
GPG_KEY_SIGN='{{ backup_gpg_key_sign }}'
GPG_PW_SIGN='{{ backup_gpg_pw_sign }}'
GPG_OPTS='{{ backup_gpg_opts }}'
{% endif %}

{% if backup_target_method == "azure" %}
TARGET='{{ backup_target }}-{{ item[0]['name'] }}'
{% else %}
TARGET='{{ backup_target }}/{{ item[0]['name'] }}'
{% endif %}
{% if aws_backup_region is defined and aws_backup_region != 'us-east-1' %}
AWS_DEFAULT_REGION='{{ aws_backup_region}}'
export AWS_DEFAULT_REGION
{% endif %}

TARGET_USER='{{ backup_target_user }}'
TARGET_PASS='{{ backup_target_pass }}'

SOURCE='{{ item[0]['source'] }}'

# Time frame for old backups to keep, Used for the "purge" command.  
# see duplicity man page, chapter TIME_FORMATS)
MAX_AGE='{{ backup_max_age }}'

# Number of full backups to keep. Used for the "purge-full" command. 
# See duplicity man page, action "remove-all-but-n-full".
MAX_FULL_BACKUPS='{{ backup_max_full_backups }}'

VERBOSITY={{ backup_verbosity }}

ARCH_DIR={{ backup_work }}/arch/{{ item[0]['name'] }}

# activates duplicity --full-if-older-than option (since duplicity v0.4.4.RC3)
# forces a full backup if last full backup reaches a specified age, for the
# format of MAX_FULLBKP_AGE see duplicity man page, chapter TIME_FORMATS
MAX_FULLBKP_AGE={{ backup_full_max_age }}
DUPL_PARAMS="$DUPL_PARAMS --full-if-older-than $MAX_FULLBKP_AGE "

# sets duplicity --volsize option (available since v0.4.3.RC7)
# set the size of backup chunks to VOLSIZE MB instead of the default 25MB.
# VOLSIZE must be number of MB's to set the volume size to.
VOLSIZE={{ backup_volsize }}
DUPL_PARAMS="$DUPL_PARAMS --volsize $VOLSIZE "

# exclude folders containing exclusion file (since duplicity 0.5.14)
# Uncomment the following two lines to enable this setting.
#FILENAME='.duplicity-ignore'
#DUPL_PARAMS="$DUPL_PARAMS --exclude-if-present '$FILENAME'"

# Add params needed for target or backup process.
{% for param in item[0]['params']|default([]) %}
{{ param }}
{% endfor %}

# temporary file space. at least the size of the biggest file in backup
# for a successful restoration process. (default is '/tmp', if not set)
TEMP_DIR={{ backup_temp_dir }}

# more duplicity command line options can be added in the following way
# don't forget to leave a separating space char at the end
#DUPL_PARAMS="$DUPL_PARAMS --put_your_options_here "
