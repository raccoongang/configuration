---

- name: Install mysql and dependencies
  apt:
    name: "{{ mysql_debian_pkgs }}"
    install_recommends: yes
    state: present
  register: mysql_apt_install

- name: Start mysql
  service:
    name: mysql
    state: started

- name: Start mysql_upgrade
  command: mysql_upgrade
  register: mysql_upgrade
  failed_when: mysql_upgrade.rc == 1
  when: mysql_apt_install.changed

- name: Ensure Anonymous user(s) does not exist
  mysql_user:
    name: ''
    host: "{{ item }}"
    state: absent
  with_items:
    - localhost
    - "{{ ansible_hostname }}"
